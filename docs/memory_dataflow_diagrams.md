# Agent Memory & Decision Logging - Data Flow Diagrams

## 1. Complete System Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AGENT EXECUTION CYCLE                             â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. ASSESS CONTEXT                                              â”‚    â”‚
â”‚  â”‚     â€¢ Query STM for recent market data                          â”‚    â”‚
â”‚  â”‚     â€¢ Check LTM for similar historical contexts                 â”‚    â”‚
â”‚  â”‚     â€¢ Calculate volatility, trend, volume                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                            â”‚
â”‚                              â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  2. SELECT SOURCES (WITH MEMORY)                                â”‚    â”‚
â”‚  â”‚     â€¢ Retrieve recent source performance (STM)                  â”‚    â”‚
â”‚  â”‚     â€¢ Query learned patterns from LTM                           â”‚    â”‚
â”‚  â”‚     â€¢ Calculate combined scores (70% tech + 30% learning)       â”‚    â”‚
â”‚  â”‚     â€¢ Apply context-specific boosts                             â”‚    â”‚
â”‚  â”‚     â€¢ Make selection                                            â”‚    â”‚
â”‚  â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚    â”‚
â”‚  â”‚     LOG DECISION: "SOURCE_SELECTION"                            â”‚    â”‚
â”‚  â”‚       Context: market state, cycle, patterns applied            â”‚    â”‚
â”‚  â”‚       Reasoning: scores, selected sources, why                  â”‚    â”‚
â”‚  â”‚       Decision ID: dec_123                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                            â”‚
â”‚                              â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  3. QUERY DATA SOURCES                                          â”‚    â”‚
â”‚  â”‚     For each selected source:                                   â”‚    â”‚
â”‚  â”‚       â€¢ Check rate limits (from STM)                            â”‚    â”‚
â”‚  â”‚       â€¢ Check circuit breaker state                             â”‚    â”‚
â”‚  â”‚       â€¢ Execute query                                           â”‚    â”‚
â”‚  â”‚       â€¢ Store result in STM (1h TTL)                            â”‚    â”‚
â”‚  â”‚       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚    â”‚
â”‚  â”‚       LOG DECISION: "QUERY_EXECUTION"                           â”‚    â”‚
â”‚  â”‚         Source: whaleMovements                                  â”‚    â”‚
â”‚  â”‚         Parameters: threshold, timeframe                        â”‚    â”‚
â”‚  â”‚         Parent: dec_123                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                            â”‚
â”‚                              â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  4. GENERATE SIGNALS                                            â”‚    â”‚
â”‚  â”‚     â€¢ Analyze query results                                     â”‚    â”‚
â”‚  â”‚     â€¢ Apply signal generation rules                             â”‚    â”‚
â”‚  â”‚     â€¢ Calculate confidence scores                               â”‚    â”‚
â”‚  â”‚     â€¢ Determine target agents                                   â”‚    â”‚
â”‚  â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚    â”‚
â”‚  â”‚     LOG DECISION: "SIGNAL_GENERATION"                           â”‚    â”‚
â”‚  â”‚       Signal type: WHALE_ACTIVITY                               â”‚    â”‚
â”‚  â”‚       Confidence: 0.85                                          â”‚    â”‚
â”‚  â”‚       Reasoning: pattern match + threshold                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                            â”‚
â”‚                              â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  5. LOG OUTCOMES                                                â”‚    â”‚
â”‚  â”‚     â€¢ Link outcomes to decision IDs                             â”‚    â”‚
â”‚  â”‚     â€¢ Record success/failure                                    â”‚    â”‚
â”‚  â”‚     â€¢ Calculate quality metrics                                 â”‚    â”‚
â”‚  â”‚     â€¢ Update agent learning metrics                             â”‚    â”‚
â”‚  â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚    â”‚
â”‚  â”‚     UPDATE DECISION: dec_123                                    â”‚    â”‚
â”‚  â”‚       Outcome: 2 signals generated, quality 0.85                â”‚    â”‚
â”‚  â”‚       Success: true                                             â”‚    â”‚
â”‚  â”‚       Latency: 1.2s                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                            â”‚
â”‚                              â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  6. CONSOLIDATE LEARNING (Periodic)                             â”‚    â”‚
â”‚  â”‚     â€¢ Query recent decisions (last 24h)                         â”‚    â”‚
â”‚  â”‚     â€¢ Identify patterns with high success rate                  â”‚    â”‚
â”‚  â”‚     â€¢ Calculate pattern confidence                              â”‚    â”‚
â”‚  â”‚     â€¢ Promote patterns to LTM                                   â”‚    â”‚
â”‚  â”‚     â€¢ Update existing pattern confidences                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Memory Read Flow

```
Agent needs to make decision
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  STM    â”‚ Redis lookup (< 1ms)      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                            â”‚
         â”‚                                 â”‚
    Cache hit?                             â”‚
    â”‚         â”‚                            â”‚
    YES       NO                           â”‚
    â”‚         â”‚                            â”‚
    â”‚         â–¼                            â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚    â”‚ Check   â”‚ DynamoDB query       â”‚
    â”‚    â”‚  LTM    â”‚ (10-50ms)            â”‚
    â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â”‚
    â”‚         â”‚                            â”‚
    â”‚    Found?                            â”‚
    â”‚    â”‚    â”‚                            â”‚
    â”‚   YES   NO                           â”‚
    â”‚    â”‚    â”‚                            â”‚
    â”‚    â”‚    â–¼                            â”‚
    â”‚    â”‚  Return                         â”‚
    â”‚    â”‚  default                        â”‚
    â”‚    â”‚                                 â”‚
    â”‚    â–¼                                 â”‚
    â”‚  Store in â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  STM for
    â”‚  future hits
    â”‚    â”‚
    â–¼    â–¼
  Use memory
  in decision
```

## 3. Memory Write Flow

```
Decision made / Data available
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Write   â”‚ Redis SET (< 1ms)
    â”‚  to     â”‚ with TTL
    â”‚  STM    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    High value         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    or persistent? â”€â”€â”€â†’â”‚  Write to LTM    â”‚
    â”‚         â”‚        â”‚  (DynamoDB)      â”‚
    YES       NO       â”‚  Async           â”‚
    â”‚         â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚
    â”‚         â–¼
    â”‚    Done (STM only)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Write to    â”‚ DynamoDB PutItem
â”‚ DynamoDB    â”‚ (10-50ms)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
Done (STM + LTM)
```

## 4. Decision Logging Flow - Detailed

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BEFORE DECISION                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1. Gather Context                                           â”‚
â”‚     â”œâ”€ Market state (volatility, trend, volume)              â”‚
â”‚     â”œâ”€ Agent state (cycle, exploration rate)                 â”‚
â”‚     â”œâ”€ Recent memory (STM queries)                           â”‚
â”‚     â””â”€ Applied patterns (LTM patterns)                       â”‚
â”‚                                                               â”‚
â”‚  2. Create Decision Record                                   â”‚
â”‚     decision = {                                             â”‚
â”‚       "decision_id": generate_uuid(),                        â”‚
â”‚       "timestamp": now,                                      â”‚
â”‚       "decision_type": "SOURCE_SELECTION",                   â”‚
â”‚       "context": gathered_context,                           â”‚
â”‚       "reasoning": {},  # To be filled                       â”‚
â”‚       "outcome": None   # To be filled later                 â”‚
â”‚     }                                                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MAKE DECISION                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  3. Execute Decision Logic                                   â”‚
â”‚     â”œâ”€ Calculate scores                                      â”‚
â”‚     â”œâ”€ Apply memory influence                                â”‚
â”‚     â”œâ”€ Apply pattern boosts                                  â”‚
â”‚     â”œâ”€ Handle exploration                                    â”‚
â”‚     â””â”€ Make selection                                        â”‚
â”‚                                                               â”‚
â”‚  4. Add Reasoning to Record                                  â”‚
â”‚     decision["reasoning"] = {                                â”‚
â”‚       "scores": calculated_scores,                           â”‚
â”‚       "selected": selected_sources,                          â”‚
â”‚       "memory_influenced": True,                             â”‚
â”‚       "patterns_applied": pattern_ids,                       â”‚
â”‚       "exploration": exploration_triggered                   â”‚
â”‚     }                                                         â”‚
â”‚                                                               â”‚
â”‚  5. Write Decision to Database                               â”‚
â”‚     await decision_logger.log_decision(decision)             â”‚
â”‚     â”œâ”€ DynamoDB: agent_decisions table                       â”‚
â”‚     â”œâ”€ Redis: decision_chain list                            â”‚
â”‚     â””â”€ Return: decision_id                                   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXECUTE DECISION                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  6. Perform Actions                                          â”‚
â”‚     â”œâ”€ Query selected sources                                â”‚
â”‚     â”œâ”€ Generate signals                                      â”‚
â”‚     â”œâ”€ Update metrics                                        â”‚
â”‚     â””â”€ Collect outcomes                                      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AFTER DECISION                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  7. Log Outcome                                              â”‚
â”‚     outcome = {                                              â”‚
â”‚       "success": signals_generated > 0,                      â”‚
â”‚       "signals_generated": 2,                                â”‚
â”‚       "quality_score": 0.85,                                 â”‚
â”‚       "latency_ms": 1200,                                    â”‚
â”‚       "errors": []                                           â”‚
â”‚     }                                                         â”‚
â”‚                                                               â”‚
â”‚  8. Update Decision Record                                   â”‚
â”‚     await decision_logger.log_outcome(                       â”‚
â”‚       decision_id,                                           â”‚
â”‚       outcome                                                â”‚
â”‚     )                                                         â”‚
â”‚     â”œâ”€ DynamoDB: Update item with outcome                    â”‚
â”‚     â”œâ”€ Calculate success metrics                             â”‚
â”‚     â””â”€ Trigger learning if needed                            â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. Pattern Learning Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONSOLIDATION JOB (Every 6 hours)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Query Recent  â”‚
                    â”‚ Decisions     â”‚
                    â”‚ (last 24h)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Group By      â”‚
                    â”‚ Context       â”‚
                    â”‚ â€¢ Volatility  â”‚
                    â”‚ â€¢ Trend       â”‚
                    â”‚ â€¢ Hour        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Analyze Each Group      â”‚
              â”‚ â€¢ Success rate          â”‚
              â”‚ â€¢ Quality scores        â”‚
              â”‚ â€¢ Common sources        â”‚
              â”‚ â€¢ Timing patterns       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Identify Patterns               â”‚
          â”‚                                 â”‚
          â”‚ IF success_rate > 70% AND       â”‚
          â”‚    occurrences >= 5 AND         â”‚
          â”‚    quality_avg > 0.7            â”‚
          â”‚ THEN create pattern             â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Calculate Pattern Confidence          â”‚
    â”‚                                       â”‚
    â”‚ confidence = (                        â”‚
    â”‚   0.4 * success_rate +                â”‚
    â”‚   0.3 * quality_score +               â”‚
    â”‚   0.2 * sample_size_norm +            â”‚
    â”‚   0.1 * recency_bonus                 â”‚
    â”‚ )                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Store Pattern in LTM                  â”‚
    â”‚                                       â”‚
    â”‚ pattern = {                           â”‚
    â”‚   "pattern_id": generate_id(),        â”‚
    â”‚   "type": "context_source_combo",     â”‚
    â”‚   "context": {"volatility": "high"},  â”‚
    â”‚   "sources": ["whaleMovements"],      â”‚
    â”‚   "confidence": 0.85,                 â”‚
    â”‚   "success_rate": 0.78,               â”‚
    â”‚   "sample_size": 15                   â”‚
    â”‚ }                                     â”‚
    â”‚                                       â”‚
    â”‚ await memory.store_ltm(pattern)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. Multi-Agent Memory Sharing (Future)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SHARED MEMORY POOL                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Market       â”‚  â”‚ Risk         â”‚  â”‚ Trading      â”‚     â”‚
â”‚  â”‚ Hunter       â”‚  â”‚ Manager      â”‚  â”‚ Executor     â”‚     â”‚
â”‚  â”‚ Agent        â”‚  â”‚ Agent        â”‚  â”‚ Agent        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                  â”‚                  â”‚             â”‚
â”‚         â”‚    Write         â”‚    Read          â”‚             â”‚
â”‚         â”‚    decisions     â”‚    risk signals  â”‚             â”‚
â”‚         â”‚                  â”‚                  â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                            â”‚                                â”‚
â”‚                            â–¼                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚  Agent Communication     â”‚                  â”‚
â”‚              â”‚  Memory Space            â”‚                  â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚              â”‚  â”‚ Market Hunter says:â”‚  â”‚                  â”‚
â”‚              â”‚  â”‚ "WHALE_ACTIVITY"   â”‚  â”‚                  â”‚
â”‚              â”‚  â”‚ confidence: 0.85   â”‚  â”‚                  â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚              â”‚  â”‚ Risk Manager says: â”‚  â”‚                  â”‚
â”‚              â”‚  â”‚ "HIGH_RISK_ALERT"  â”‚  â”‚                  â”‚
â”‚              â”‚  â”‚ action: "REDUCE"   â”‚  â”‚                  â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚  Each agent:                                               â”‚
â”‚  â€¢ Writes its own decisions to shared space                â”‚
â”‚  â€¢ Reads other agents' signals                             â”‚
â”‚  â€¢ Learns from collective outcomes                         â”‚
â”‚  â€¢ Respects agent-specific privacy settings                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. Query Patterns

### Pattern A: Get Recent Context
```
Agent â†’ Memory Manager
  â”œâ”€ "Get STM: recent_context"
  â””â”€ Redis: GET stm:market-hunter:context:current
      â””â”€ Returns: {volatility: "high", trend: "bullish"}
```

### Pattern B: Get Historical Pattern
```
Agent â†’ Memory Manager
  â”œâ”€ "Get LTM patterns for high_volatility"
  â””â”€ DynamoDB: Query agent_memory_ltm
      WHERE PK = "market-hunter#PATTERN"
      AND confidence > 0.7
      â””â”€ Returns: 5 patterns
```

### Pattern C: Log Decision with Outcome
```
Agent â†’ Decision Logger
  â”œâ”€ 1. log_decision(type, context, reasoning)
  â”‚   â””â”€ DynamoDB: PutItem to agent_decisions
  â”‚       â””â”€ Returns: decision_id
  â”‚
  â”œâ”€ ... (execute decision) ...
  â”‚
  â””â”€ 2. log_outcome(decision_id, outcome)
      â””â”€ DynamoDB: UpdateItem agent_decisions
          SET outcome = {success: true, ...}
```

### Pattern D: Hierarchical Retrieval
```
Memory Manager receives request
  â”‚
  â”œâ”€ 1. Check Redis (STM) - < 1ms
  â”‚   â””â”€ Hit? Return immediately
  â”‚
  â”œâ”€ 2. Check DynamoDB hot partition (< 24h) - 10ms
  â”‚   â””â”€ Hit? Cache in Redis + return
  â”‚
  â”œâ”€ 3. Check DynamoDB (1-30 days) - 50ms
  â”‚   â””â”€ Hit? Cache in Redis + return
  â”‚
  â””â”€ 4. Check S3 (archive) - 100-500ms
      â””â”€ Hit? Cache in Redis + return
```

## 8. Cost Flow

```
OPERATION                    COST        FREQUENCY/MONTH    MONTHLY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STM Write (Redis)            Free*       ~500K              $0
STM Read (Redis)             Free*       ~1M                $0
LTM Write (DynamoDB)         $1.25/M     26K                $0.03
LTM Read (DynamoDB)          $0.25/M     100K               $0.03
Decision Log Write           $1.25/M     26K                $0.03
Decision Log Read            $0.25/M     50K                $0.01
S3 Storage                   $0.023/GB   1 GB               $0.02
Redis Instance               Hourly      720h               $12.00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL                                                       ~$12.12

* Redis operations included in instance cost
```

---

This completes the data flow visualization. The diagrams show:
1. Complete system flow from decision to learning
2. Memory read/write patterns
3. Decision logging lifecycle
4. Pattern learning process
5. Future multi-agent architecture
6. Common query patterns
7. Cost breakdown

Ready to discuss and move to implementation! ğŸš€
